name: Update Last Modified Date

on:
  push:
    branches: [ "main" ]  

jobs:
  update-date:
    runs-on: ubuntu-latest
    permissions:
      contents: write  
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  

      - name: Update last modified date
        id: update-date
        run: |
          CURRENT_DATE=$(date +"%Y-%m-%d")
          sed -i "s/> æœ€åæ›´æ–°æ—¶é—´ï¼š.*/> æœ€åæ›´æ–°æ—¶é—´ï¼š$CURRENT_DATE/" README.md
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
          if git diff --exit-code --quiet README.md; then
            echo "æ²¡æœ‰å˜æ›´ï¼Œè·³è¿‡æäº¤"
            echo "should_commit=false" >> $GITHUB_OUTPUT
          else
            echo "æ£€æµ‹åˆ°æ›´æ”¹ï¼Œå‡†å¤‡æäº¤"
            echo "should_commit=true" >> $GITHUB_OUTPUT
          fi

      - name: Commit and push changes
        if: steps.update-date.outputs.should_commit == 'true'
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add README.md
          git commit -m "ğŸ“… è‡ªåŠ¨æ›´æ–°æœ€åä¿®æ”¹æ—¥æœŸ [$CURRENT_DATE]"
          git push
